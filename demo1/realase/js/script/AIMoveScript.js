var __extends=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function a(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(a.prototype=o.prototype,new a)}}(),AIMoveScript=function(t){function e(){var e=t.call(this)||this;return e._moveTween=new Laya.Tween,e._convertLocalToGlobalPoint=new Laya.Point,e._vec33DPos=new Laya.Vector3,e}return __extends(e,t),e.prototype._load=function(t){this._pCharacter=this.owner,this._pRoleSp3D=this._pCharacter.roleSp3D,Laya.timer.frameLoop(1,this,this._convert2DPosTo3D)},e.prototype._start=function(t){},e.prototype._update=function(t){},e.prototype.onTriggerEnter=function(t){},e.prototype.onTriggerStay=function(t){},e.prototype.onTriggerExit=function(t){},e.prototype.startup=function(t){this._pAgentSprite2D=t,this._moveTween.clear(),Laya.Tween.clearAll(this._pAgentSprite2D),this._findTargetPos()},e.prototype.stopFindPath=function(){this._moveTween.pause()},e.prototype.resumeFindPath=function(){this._moveTween.resume()},e.prototype._findTargetPos=function(){this._pathX=250+(SceneManager.instance.bgLayer.width-450)*Math.random(),this._pathY=350+(SceneManager.instance.bgLayer.height-750)*Math.random();var t=Math.sqrt((this._pathX-this._pAgentSprite2D.x)*(this._pathX-this._pAgentSprite2D.x)+(this._pathY-this._pAgentSprite2D.y)*(this._pathY-this._pAgentSprite2D.y))/this._pCharacter.data.speed;this._moveTween.to(this._pAgentSprite2D,{x:this._pathX,y:this._pathY},1e3*t,Laya.Ease.linearNone,Laya.Handler.create(this,this._findTargetPos)),this._turn(),this._pCharacter.changeAction(CharacterActionStateConst.RUN)},e.prototype._turn=function(){var t=new Laya.Point(this._pathX,this._pathY);t=SceneManager.instance.bgLayer.localToGlobal(t);var e=new Laya.Vector3;e.fromArray([t.x,t.y,0]);var o=new Laya.Vector3;SceneManager.instance.convertScreenCoordToOrthographicCoord(e,o);var a=o.y-this._pRoleSp3D.transform.position.y,r=o.x-this._pRoleSp3D.transform.position.x,n=180*(Math.atan2(a,r)+.5*Math.PI)/Math.PI;n=0>n?360+n:n;var i=this._pRoleSp3D.transform.localRotationEuler;i?(this._characterEuler=i,Laya.Tween.clearTween(i),n-i.y>180?n-=360:n-i.y<-180&&(n+=360),Laya.Tween.to(i,{y:n,update:new Laya.Handler(this,this._rotationUpdate)},60,Laya.Ease.linearOut,null,0)):this._pRoleSp3D.transform.localRotationEuler=new Laya.Vector3(0,n,0)},e.prototype._rotationUpdate=function(){this._characterEuler.y>360?this._characterEuler.y-=360:this._characterEuler.y<0&&(this._characterEuler.y+=360),this._pRoleSp3D&&(this._pRoleSp3D.transform.localRotationEuler=this._characterEuler)},e.prototype._convert2DPosTo3D=function(){this._pAgentSprite2D&&(this._convertLocalToGlobalPoint.setTo(this._pAgentSprite2D.x,this._pAgentSprite2D.y),this._convertLocalToGlobalPoint=SceneManager.instance.bgLayer.localToGlobal(this._convertLocalToGlobalPoint),this._pCharacter.pos2D.x=this._convertLocalToGlobalPoint.x*Laya.stage.clientScaleX,this._pCharacter.pos2D.y=this._convertLocalToGlobalPoint.y*Laya.stage.clientScaleY,SceneManager.instance.convertScreenCoordToOrthographicCoord(this._pCharacter.pos2D,this._vec33DPos),this._pRoleSp3D.transform.position=this._vec33DPos)},e}(Laya.Script);