var Level=function(){function e(){this._pPos2dVec3=new Laya.Vector3,this._characterEuler=new Laya.Vector3,this.roleID=[6105,6111,6600,6609,6610,6635,6690,6697,6701,6709,6714,6724,8204,"longnv","zhujue"]}return e.prototype.enter=function(){LoaderManager.instance.loadImage2D([{url:"res/scene2d/small.jpg",type:Laya.Loader.IMAGE},{url:"res/scene2d/bloodBar.png",type:Laya.Loader.IMAGE},{url:"res/scene2d/bloodBarBg.png",type:Laya.Loader.IMAGE}],this,this._scene2dComplete,"加载场景中")},e.prototype._scene2dComplete=function(){var e=new Laya.Image;e.texture=Laya.loader.getRes("res/scene2d/small.jpg"),SceneManager.instance.initScene2D(e),SceneManager.instance.initScene3D();for(var a=[],t=0;t<this.roleID.length;t++){var r=this.roleID[t],n={url:Character.BODY_RES_URL+r+"/"+r+".lh"};a.push(n)}a.push({url:Character.WING_RES_URL+6437+"/6437.lh"}),a.push({url:Character.HORSE_RES_URL+6044+"/6044.lh"}),LoaderManager.instance.loadSprite3D(a,this,this._characterLoadComplete,"加载角色中")},e.prototype._readyEnterFight=function(){Laya.timer.once(5e3,this,this._enterFight)},e.prototype._characterLoadComplete=function(){var e=new Laya.Point;SceneManager.instance.addMainCharacterAIControl();for(var a=0;a<this.roleID.length-1;a++){var t=this.roleID[a],r=250+(SceneManager.instance.bgLayer.width-450)*Math.random(),n=350+(SceneManager.instance.bgLayer.height-750)*Math.random();e.setTo(r,n),SceneManager.instance.addCharacter(t,a,e)}this._readyEnterFight(),AIFightControl.instance.on("fightEnd",this,this._readyEnterFight)},e.prototype._clickStage=function(){this._pPos2dVec3.fromArray([Laya.stage.mouseX,Laya.stage.mouseY,0]);var e=new Laya.Vector3;SceneManager.instance.curCamera3D.convertScreenCoordToOrthographicCoord(this._pPos2dVec3,e);var a=e.y-this._mianCharacter.transform.position.y,t=e.x-this._mianCharacter.transform.position.x,r=180*(Math.atan2(a,t)+.5*Math.PI)/Math.PI;r=0>r?360+r:r;var n=this._mianCharacter.transform.localRotationEuler;n?(this._characterEuler=n,Laya.Tween.clearTween(n),r-n.y>180?r-=360:r-n.y<-180&&(r+=360),Laya.Tween.to(n,{y:r,update:new Laya.Handler(this,this._rotationUpdate)},60,Laya.Ease.linearOut,null,0)):this._mianCharacter.transform.localRotationEuler=new Laya.Vector3(0,r,0),this._mianCharacter.changeAction(CharacterActionStateConst.RUN);var o=SceneManager.instance.bgLayer.globalToLocal(new Laya.Point(this._pPos2dVec3.x,this._pPos2dVec3.y));SceneManager.instance.camera2D.focusTarget=o},e.prototype._rotationUpdate=function(){this._characterEuler.y>360?this._characterEuler.y-=360:this._characterEuler.y<0&&(this._characterEuler.y+=360),this._mianCharacter&&(this._mianCharacter.transform.localRotationEuler=this._characterEuler)},e.prototype._enterFight=function(){SceneManager.instance.enterFight()},e}();